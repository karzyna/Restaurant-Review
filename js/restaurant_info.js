let restaurant,reviews;var map,refreshing;window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img",t.srcset="/img/small_"+e.photograph+".jpg 500w, /img/"+e.photograph+".jpg 1000w, ",t.src=DBHelper.imageUrlForRestaurant(e),t.alt=DBHelper.altTextForRestaurant(e),t.setAttribute("aria-label","restaurant: "+e.name),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),favRestaurant(),DBHelper.fetchReviewsByRestaurantId(e.id,(e,t)=>{self.reviews=t,t?fillReviewsHTML():console.error(e)})}),favRestaurant=((e=self.restaurant)=>{console.log(e),console.log("id: ",e.id,"isfav: ",e.is_favorite);const t=document.getElementsByClassName("wrapper")[0];t.classList.add("overlay");const n=document.getElementsByTagName("span");n.innerHTML="Add to your favorites",e.is_favorite?(t.classList.remove("overlay"),n.innerHTML="",t.classList.add("favourite")):(n.innerHTML="Add to your favorites",t.classList.add("overlay")),t.onclick=function(){this.classList.toggle("overlay"),this.classList.toggle("favourite")?this.getElementsByTagName("span")[0].innerHTML="":this.getElementsByTagName("span")[0].innerHTML="Add to your favourites";const t=!e.is_favorite;DBHelper.updateFavouriteStatus(e.id,t),e.is_favorite=!e.is_favorite}}),addReview=(e=>{e.preventDefault(),console.log("cickcick");let t,n=getParameterByName("id"),r=document.getElementById("review-author").value,a=document.getElementById("review-opinion").value;const o=[r,t=document.querySelector("#rating_select option:checked").value,a,n];console.log(o);const i={restaurant_id:parseInt(o[3]),rating:parseInt(o[1]),name:o[0],opinion:o[2].substring(0,300),createdAt:new Date};console.log("log",i),DBHelper.addReview(i),createReviewHTML(i),document.getElementById("review-form").reset()}),createReviewHTML=(e=>{const t=document.createElement("li");if(!navigator.onLine){const e=document.createElement("p");e.classtist.add("offLine_label"),e.innerHTML="Offline",t.classList.add("reviews_offline"),t.appendChild(e)}const n=document.createElement("p");n.innerHTML=`Name: ${e.name}`,t.appendChild(n);const r=document.createElement("p");r.innerHTML=`Date: ${new Date(e.createdAt).toLocaleString()}`,t.appendChild(r);const a=document.createElement("p");a.innerHTML=`Rating: ${e.rating}`,t.appendChild(a);const o=document.createElement("p");return o.innerHTML=e.opinion,t.appendChild(o),t}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const o=document.createElement("td");o.innerHTML=e[n],r.appendChild(o),t.appendChild(r)}}),fillReviewsHTML=((e=self.reviews)=>{console.log(e);const t=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.innerHTML="Reviews",t.appendChild(n),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.append(e)}const r=document.getElementById("reviews-list");e.forEach(e=>{r.appendChild(createReviewHTML(e))}),t.appendChild(r)}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);const r=document.createElement("p");console.log("review",e),r.innerHTML=e.createdAt,t.appendChild(r);const a=document.createElement("p");a.innerHTML=`RATING: ${e.rating}`,t.appendChild(a);const o=document.createElement("p");return o.innerHTML=e.comments,t.appendChild(o),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,n.setAttribute("aria-current","page"),t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}),window.setTimeout(()=>{document.querySelectorAll("#map iframe").forEach(e=>{e.setAttribute("title","Google maps iframe")}),DBHelper.removeMapsTabOrder()},1e3),navigator.serviceWorker.register("/sw.js").then(function(e){console.log("Registration worked."),navigator.serviceWorker.controller&&(e.waiting&&navigator.serviceWorker.controller.postMessage({action:"skipWaiting"}),e.installing&&navigator.serviceWorker.addEventListener("statechange",function(){"installed"==navigator.serviceWorker.controller.state&&navigator.serviceWorker.controller.postMessage({action:"skipWaiting"})}),e.addEventListener("updatefound",function(){navigator.serviceWorker.addEventListener("statechange",function(){"installed"==navigator.serviceWorker.controller.state&&navigator.serviceWorker.controller.postMessage({action:"skipWaiting"})})}))}).catch(function(){console.log("Registration failed")}),navigator.serviceWorker.addEventListener("controllerchange",function(){refreshing||(window.location.reload(),refreshing=!0)});const toggle_map=()=>{console.log("toggle"),"none"===document.getElementById("map").style.display?(document.getElementById("map").style.display="block",document.getElementById("collapsible").style.display=" none"):document.getElementById("map").style.display="none"};